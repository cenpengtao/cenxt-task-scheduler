(function(e){function t(t){for(var n,a,i=t[0],l=t[1],c=t[2],u=0,d=[];u<i.length;u++)a=i[u],Object.prototype.hasOwnProperty.call(r,a)&&r[a]&&d.push(r[a][0]),r[a]=0;for(n in l)Object.prototype.hasOwnProperty.call(l,n)&&(e[n]=l[n]);p&&p(t);while(d.length)d.shift()();return s.push.apply(s,c||[]),o()}function o(){for(var e,t=0;t<s.length;t++){for(var o=s[t],n=!0,i=1;i<o.length;i++){var l=o[i];0!==r[l]&&(n=!1)}n&&(s.splice(t--,1),e=a(a.s=o[0]))}return e}var n={},r={app:0},s=[];function a(t){if(n[t])return n[t].exports;var o=n[t]={i:t,l:!1,exports:{}};return e[t].call(o.exports,o,o.exports,a),o.l=!0,o.exports}a.m=e,a.c=n,a.d=function(e,t,o){a.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:o})},a.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},a.t=function(e,t){if(1&t&&(e=a(e)),8&t)return e;if(4&t&&"object"===typeof e&&e&&e.__esModule)return e;var o=Object.create(null);if(a.r(o),Object.defineProperty(o,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var n in e)a.d(o,n,function(t){return e[t]}.bind(null,n));return o},a.n=function(e){var t=e&&e.__esModule?function(){return e["default"]}:function(){return e};return a.d(t,"a",t),t},a.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},a.p="";var i=window["webpackJsonp"]=window["webpackJsonp"]||[],l=i.push.bind(i);i.push=t,i=i.slice();for(var c=0;c<i.length;c++)t(i[c]);var p=l;s.push([0,"chunk-vendors"]),o()})({0:function(e,t,o){e.exports=o("56d7")},"0346":function(e,t,o){"use strict";o("e248")},"2a80":function(e,t,o){},3706:function(e,t,o){"use strict";o("2a80")},"56d7":function(e,t,o){"use strict";o.r(t);o("cadf"),o("551c"),o("f751"),o("097d");var n,r=o("2b0e"),s=function(){var e=this,t=e.$createElement,o=e._self._c||t;return o("div",{attrs:{id:"app"}},[o("router-view",{staticClass:"container"})],1)},a=[],i={name:"app",data:function(){return{}},methods:{}},l=i,c=(o("0346"),o("2877")),p=Object(c["a"])(l,s,a,!1,null,"26fb7742",null),u=p.exports,d=o("8c4f"),f=function(){var e=this,t=e.$createElement,o=e._self._c||t;return o("div",{attrs:{id:"app"}},[o("Row",{staticClass:"container",attrs:{type:"flex",justify:"center",align:"middle"}},[o("Col",{attrs:{span:"8"}}),o("Col",{attrs:{span:"8"}},[o("div",{staticClass:"login-container"},[o("div",{staticClass:"login-title"},[e._v("登录")]),o("Form",{staticClass:"login-form"},[o("FormItem",[o("Input",{attrs:{size:"large",placeholder:"用户名"},on:{"on-enter":e.login},model:{value:e.username,callback:function(t){e.username=t},expression:"username"}})],1),o("FormItem",[o("Input",{attrs:{type:"password",size:"large",placeholder:"密码"},on:{"on-enter":e.login},model:{value:e.password,callback:function(t){e.password=t},expression:"password"}})],1),o("FormItem",[o("Button",{attrs:{type:"success",size:"large",long:""},on:{click:e.login}},[e._v("登录")])],1)],1)],1)]),o("Col",{attrs:{span:"8"}})],1)],1)},m=[],h={storage:{local:{set:function(e,t){window.localStorage.setItem(e,t)},get:function(e){return window.localStorage.getItem(e)},remove:function(e){window.localStorage.removeItem(e)},clear:function(){window.localStorage.clear()}},session:{set:function(e,t){window.sessionStorage.setItem(e,t)},get:function(e){return window.sessionStorage.getItem(e)},remove:function(e){window.sessionStorage.removeItem(e)},clear:function(){window.sessionStorage.clear()}}},formatDate:function(e){if(void 0==e)return"";var t=new Date(e),o=t.getFullYear(),n=t.getMonth()+1,r=t.getDate(),s=t.getHours(),a=t.getMinutes(),i=t.getSeconds();n<10&&(n="0"+n),r<10&&(r="0"+r),s<10&&(s="0"+s),a<10&&(a="0"+a),i<10&&(i="0"+i);var l=o+"-"+n+"-"+r+" "+s+":"+a+":"+i;return l}},g=h,k=(o("a481"),o("f559"),o("bc3a")),w=o.n(k),x={server:".",getUrl:function(e){return e.startsWith("/")?x.server+e:e.startsWith("http")?e:x.server+"/"+e},get:function(e,t,o){w.a.get(x.getUrl(e)).then((function(e){t&&t(e.data)})).catch((function(e){x.handleError(e,o)}))},delete:function(e,t,o){w.a.delete(x.getUrl(e)).then((function(e){t&&t(e.data)})).catch((function(e){x.handleError(e,o)}))},post:function(e,t,o,n){w.a.post(x.getUrl(e),t).then((function(e){o&&o(e.data)})).catch((function(e){x.handleError(e,n)}))},handleError:function(e,t){console.error(e),e.response?(console.error(e.response),"401"==e.response.status?(t&&t({message:"未登录",code:401}),P.push("/login")):"403"==e.response.status?(t&&t({message:"无权访问",code:403}),"/"!=P.path&&P.replace("/")):t&&t({code:e.response.status,message:e.response.data})):t&&t({message:e.message,code:99})}},y=x,b={name:"app",data:function(){return{username:"",password:""}},methods:{login:function(){var e=this;y.post("/api/login",{username:this.username,password:this.password},(function(t){window.sessionStorage.setItem("ROLE",t),e.$router.push("/")}),(function(t){e.$Notice.error({title:"["+t.code+"] "+t.message})}))}}},v=b,I=(o("3706"),Object(c["a"])(v,f,m,!1,null,"0d5f8f23",null)),S=I.exports,T=function(){var e=this,t=e.$createElement,o=e._self._c||t;return o("div",[o("div",{staticStyle:{width:"100%",height:"40px"}},["GUEST"!=e.role?o("Button",{staticStyle:{float:"left"},attrs:{type:"success",icon:"md-add"},on:{click:e.onAddTask}},[e._v("新增任务")]):e._e(),o("Button",{staticStyle:{float:"right"},attrs:{type:"success",icon:"md-refresh"},on:{click:e.getTasks}},[e._v("刷新")])],1),o("Table",{attrs:{loading:e.loading,columns:e.columns,data:e.tasks,size:"small","highlight-row":"",border:"",stripe:""}}),o("TaskInfo",{attrs:{taskInfoProp:e.taskInfo},on:{"on-ok":e.getTasks},model:{value:e.taskModel,callback:function(t){e.taskModel=t},expression:"taskModel"}}),o("Modal",{attrs:{fullscreen:""},model:{value:e.execHistoryModal,callback:function(t){e.execHistoryModal=t},expression:"execHistoryModal"}},[o("p",{attrs:{slot:"header"},slot:"header"},[o("span",[e._v("执行记录（最近"+e._s(e.execHistorySize)+"条）")])]),o("Row",[o("Col",{attrs:{span:"6"}},[o("span",[e._v("名称：")]),o("span",[e._v(e._s(e.execHistoryTask.name))])]),o("Col",{attrs:{span:"12"}},[o("span",[e._v("描述：")]),o("span",[e._v(e._s(e.execHistoryTask.description))])]),o("Col",{attrs:{span:"6"}},[o("Checkbox",{on:{"on-change":e.getExecHistory},model:{value:e.exceptionHistory,callback:function(t){e.exceptionHistory=t},expression:"exceptionHistory"}},[e._v("异常记录")]),o("Button",{attrs:{type:"success",icon:"md-refresh"},on:{click:e.getExecHistory}},[e._v("刷新")])],1)],1),o("Table",{attrs:{columns:e.execHistorycolumns,data:e.execHistory,size:"small","highlight-row":"",border:"",stripe:""}}),o("div",{attrs:{slot:"footer"},slot:"footer"})],1)],1)},_=[],$=(o("7f7f"),function(){var e=this,t=e.$createElement,o=e._self._c||t;return o("Modal",{attrs:{width:900,"mask-closable":!1,closable:!1},model:{value:e.taskModel,callback:function(t){e.taskModel=t},expression:"taskModel"}},[o("p",{attrs:{slot:"header"},slot:"header"},[e.taskInfo.id?o("span",[e._v("修改任务")]):o("span",[e._v("新建任务")])]),o("Form",{ref:"taskInfoValidate",attrs:{model:e.taskInfo,rules:e.taskInfoRules,"label-position":"left","label-width":120}},[o("Row",[o("Col",{attrs:{span:"10"}},[o("FormItem",{attrs:{label:"名称",prop:"name"}},[o("Select",{attrs:{placeholder:"名称",clearable:""},on:{"on-change":e.jobChange},model:{value:e.taskInfo.name,callback:function(t){e.$set(e.taskInfo,"name",t)},expression:"taskInfo.name"}},e._l(e.jobs,(function(t){return o("Option",{key:t.name,attrs:{value:t.name}},[e._v(e._s(t.name))])})),1)],1)],1),o("Col",{attrs:{span:"13",offset:"1"}},[o("FormItem",{attrs:{label:"表达式",prop:"cronStr","label-width":70}},[o("Poptip",{staticStyle:{width:"100%"},attrs:{disabled:0==e.cronExplain.length,value:e.cronExplain.length>0,title:"接下来"+e.explainSize+"次的执行时间",placement:"bottom"}},[o("Input",{attrs:{placeholder:"Spring cron表达式，如：0/30 * * * * ? (每30秒执行一次)",clearable:"","show-word-limit":"",maxlength:"200"},model:{value:e.taskInfo.cronStr,callback:function(t){e.$set(e.taskInfo,"cronStr",t)},expression:"taskInfo.cronStr"}}),o("div",{attrs:{slot:"content"},slot:"content"},[e.cronExplain.length>0?o("table",{staticStyle:{"border-collapse":"collapse"},attrs:{border:"1",bordercolor:"#a0c6e5"}},[o("tbody",e._l(e.cronExplain,(function(t,n){return o("tr",{key:n,attrs:{value:t}},[o("td",{staticStyle:{padding:"0 10px"}},[e._v("第"+e._s(n+1)+"次")]),o("td",{staticStyle:{padding:"0 10px"}},[e._v(e._s(e._f("formatDate")(t)))])])})),0)]):o("span",{staticStyle:{color:"red"}},[e._v("无效的表达式")])])],1)],1)],1)],1),o("Row",[o("Col",{attrs:{span:"10"}},[o("FormItem",{attrs:{label:"下次执行时间",prop:"nextTime"}},[o("DatePicker",{attrs:{type:"datetime",placeholder:"下次执行时间",clearable:""},model:{value:e.taskInfo.nextTime,callback:function(t){e.$set(e.taskInfo,"nextTime",t)},expression:"taskInfo.nextTime"}})],1)],1),o("Col",{attrs:{span:"6",offset:"1"}},[o("FormItem",{attrs:{label:"超时时间(分)",prop:"expire"}},[o("InputNumber",{attrs:{min:1,placeholder:"超时时间（分）",clearable:""},model:{value:e.taskInfo.expire,callback:function(t){e.$set(e.taskInfo,"expire",t)},expression:"taskInfo.expire"}})],1)],1),o("Col",{attrs:{span:"6",offset:"1"}},[o("FormItem",{attrs:{label:"重试次数",prop:"retryTimes"}},[o("InputNumber",{attrs:{min:0,max:5,placeholder:"重试次数",clearable:""},model:{value:e.taskInfo.retryTimes,callback:function(t){e.$set(e.taskInfo,"retryTimes",t)},expression:"taskInfo.retryTimes"}})],1)],1)],1),o("Row",[o("FormItem",{attrs:{label:"描述",prop:"description"}},[o("Input",{attrs:{placeholder:"描述",type:"textarea",rows:2,clearable:"","show-word-limit":"",maxlength:"200"},model:{value:e.taskInfo.description,callback:function(t){e.$set(e.taskInfo,"description",t)},expression:"taskInfo.description"}})],1)],1),o("Row",[o("FormItem",{attrs:{label:"参数(JSON)",prop:"params"}},[o("Input",{attrs:{placeholder:"参数(JSON)",type:"textarea",rows:10,clearable:"","show-word-limit":"",maxlength:"4000"},model:{value:e.taskInfo.params,callback:function(t){e.$set(e.taskInfo,"params",t)},expression:"taskInfo.params"}})],1)],1)],1),o("div",{attrs:{slot:"footer"},slot:"footer"},[o("Button",{attrs:{type:"success"},on:{click:e.onConfirm}},[e._v("确定")]),e.taskInfo.id?e._e():o("Button",{attrs:{type:"error"},on:{click:e.onClear}},[e._v("清空")]),o("Button",{on:{click:e.onCancel}},[e._v("取消")])],1)],1)}),C=[],O=(o("ac6a"),o("53ca")),E={data:function(){return{taskModel:!1,taskInfo:{},jobs:[],explainSize:5,readyConfirm:!1,cronExplain:[],taskInfoRules:{name:[{required:!0,message:"名称必填",trigger:"blur"}],cronStr:[{required:!0,message:"表达式必填",trigger:"blur"},{validator:function(e,t,o,r,s){var a=[];t?n.getCronExplain(t,(function(e){e||a.push(new Error("无效的表达式")),o(a)})):o(a)},trigger:"blur"}],nextTime:[{required:!0,type:"date",message:"下次执行时间必填",trigger:"blur"}],expire:[{required:!0,type:"integer",message:"超时时间必填",trigger:"blur"}],retryTimes:[{required:!0,type:"integer",message:"重试次数必填",trigger:"blur"}],description:[{required:!0,message:"描述必填",trigger:"blur"}],params:[{required:!0,message:"参数必填",trigger:"blur"},{validator:function(e,t,o,n,r){var s=[];try{var a=JSON.parse(t);"object"!=Object(O["a"])(a)&&s.push(new Error(Object(O["a"])(a)+"非JSON Object类型"))}catch(i){s.push(new Error("参数非JSON类型,错误信息:"+i.message))}o(s)}}]}}},filters:{formatDate:g.formatDate},props:{value:{type:Boolean,default:function(){return!1}},taskInfoProp:{type:Object,default:function(){return{}}}},created:function(){n=this,this.getJobs()},watch:{value:function(e){e&&(this.$refs.taskInfoValidate.resetFields(),this.cronExplain=[],this.taskInfo=JSON.parse(JSON.stringify(this.taskInfoProp)),this.taskInfo.nextTime=new Date(g.formatDate(this.taskInfo.nextTime))),this.taskModel=e}},methods:{getJobs:function(){var e=this;y.get("/api/jobs",(function(t){e.jobs=t}))},jobChange:function(e){var t={};this.jobs.forEach((function(o){o.name!=e||(t=o)})),this.taskInfo.description=t.description,this.taskInfo.params=t.paramsDescription,this.taskInfo.cronStr=t.cron,this.taskInfo.expire=t.expire,this.taskInfo.retryTimes=t.retryTimes},getCronExplain:function(e,t){var o=this;y.post("/api/cron-explain",{cronStr:e,size:this.explainSize},(function(e){o.cronExplain=e,e.length>0&&!o.readyConfirm&&(o.taskInfo.nextTime=new Date(g.formatDate(e[0]))),t&&t(e.length>0)}),(function(e){t&&t(!1)}))},onConfirm:function(){var e=this,t=this;t.readyConfirm=!0,t.$refs.taskInfoValidate.validate((function(o){t.readyConfirm=!1,o&&(t.taskInfo.params=JSON.stringify(JSON.parse(t.taskInfo.params),null,2),t.$Spin.show(),y.post("/api/admin/task",t.taskInfo,(function(){e.$emit("on-ok",t.taskInfo),t.$Spin.hide(),t.$Notice.success({title:"新增成功"}),e.$emit("input",!1),e.taskModel=!1}),(function(e){t.$Spin.hide(),t.$Notice.error({title:e.message})})))}))},onCancel:function(){this.taskModel=!1,this.$emit("input",!1)},onClear:function(){this.$refs.taskInfoValidate.resetFields(),this.taskInfo={}}}},M=E,H=(o("7b39"),Object(c["a"])(M,$,C,!1,null,null,null)),j=H.exports,R={components:{TaskInfo:j},data:function(){var e=this;return{tasks:[],role:"GUEST",loading:!1,exceptionHistory:!1,execHistory:[],execHistoryTask:{},execHistorySize:18,execHistoryModal:!1,taskModel:!1,taskInfo:{},columns:[{title:"任务编号",key:"id",width:100,tooltip:!0,fixed:"left"},{title:"任务名称",key:"name",width:180,tooltip:!0,fixed:"left"},{title:"任务描述",key:"description",width:180,tooltip:!0},{title:"执行状态",key:"flag",width:120,render:function(e,t){var o="green",n="待执行";return 1==t.row.flag?(o="orange",n="执行中"):2==t.row.flag&&(o="red",n="执行失败"),t.row.enabled||(n+="(未启用)",o="red"),e("span",{style:{color:o}},n)}},{title:"时间表达式",key:"cronStr",width:130,tooltip:!0},{title:"执行时间",key:"execTime",width:150,tooltip:!0,render:function(e,t){return e("span",g.formatDate(t.row.execTime))}},{title:"下次执行时间",key:"nextTime",width:150,tooltip:!0,render:function(e,t){return e("span",g.formatDate(t.row.nextTime))}},{title:"执行ip",key:"execIp",width:120,tooltip:!0},{title:"参数",key:"params",width:150,tooltip:!0},{title:"超时(分)",key:"expire",width:90,tooltip:!0},{title:"重试次数",key:"retryTimes",width:90,tooltip:!0},{title:"创建时间",key:"createTime",width:150,tooltip:!0,render:function(e,t){return e("span",g.formatDate(t.row.createTime))}},{title:"更新时间",key:"updateTime",width:150,tooltip:!0,render:function(e,t){return e("span",g.formatDate(t.row.updateTime))}},{title:"创建人",key:"creator",width:100,tooltip:!0},{title:"更新人",key:"updator",width:90,tooltip:!0},{title:"操作",width:330,align:"center",fixed:"right",render:function(t,o){var n=[];return"GUEST"!=e.role&&(n.push(t("Button",{props:{type:o.row.enabled?"error":"success",size:"small"},on:{click:function(){e.enableTask(o.row)}}},o.row.enabled?"禁用":"启用")),n.push(t("Button",{props:{type:"info",size:"small",icon:"md-create"},style:{marginLeft:"5px"},on:{click:function(){e.taskInfo=o.row,e.taskModel=!0}}},"编辑")),n.push(t("Button",{props:{type:"error",size:"small",icon:"md-trash"},style:{marginLeft:"5px"},on:{click:function(){e.deleteTask(o.row)}}},"删除"))),n.push(t("Button",{props:{type:"warning",size:"small",icon:"md-list"},style:{marginLeft:"5px"},on:{click:function(){e.execHistoryTask=o.row,e.getExecHistory()}}},"执行记录")),t("div",n)}}],execHistorycolumns:[{title:"序号",type:"index",width:70,fixed:"left"},{title:"执行编号",key:"execId",width:300,tooltip:!0},{title:"执行结果",key:"execResult",width:120,render:function(e,t){var o="red",n=t.row.execResult;return 0==t.row.execResult?(o="blue",n="待执行"):1==t.row.execResult?(o="orange",n="执行中"):2==t.row.execResult?(o="green",n="成功"):3==t.row.execResult?(o="black",n="重试中"):4==t.row.execResult?(o="green",n="重试成功"):5==t.row.execResult?(o="red",n="执行失败"):6==t.row.execResult&&(o="red",n="超时中断"),e("span",{style:{color:o}},n)}},{title:"执行IP",key:"execIp",width:160,tooltip:!0},{title:"耗时",key:"cost",width:120,tooltip:!0,render:function(e,t){var o=Math.floor(t.row.cost/1e3/60<<0),n=Math.floor(t.row.cost/1e3%60);return e("span",o+"分"+n+"秒")}},{title:"重试次数",key:"retryTimes",width:100,tooltip:!0},{title:"成功记录数",width:120,tooltip:!0,render:function(e,t){return e("span",t.row.execReport.successCount)}},{title:"失败记录数",width:120,tooltip:!0,render:function(e,t){return e("span",t.row.execReport.failCount)}},{title:"执行时间",key:"execTime",width:150,tooltip:!0,render:function(e,t){return e("span",g.formatDate(t.row.execTime))}},{title:"结束时间",key:"finishTime",width:150,tooltip:!0,render:function(e,t){return e("span",g.formatDate(t.row.finishTime))}},{title:"执行信息",key:"execMessage",minWidth:160,tooltip:!0}]}},mounted:function(){var e=window.sessionStorage.getItem("ROLE");console.log(e),e||(e="GUEST"),console.log(e),this.role=e,this.getTasks()},methods:{onAddTask:function(){this.taskInfo={expire:5,retryTimes:0,params:"{}",cronStr:"",nextTime:new Date,description:""},this.taskModel=!0},deleteTask:function(e){var t=this;this.$Modal.confirm({title:"确定删除"+e.name,content:"删除"+e.name+" 编号："+e.id,onOk:function(){t.$Spin.show(),y.delete("/api/admin/task/"+e.id,(function(){t.$Spin.hide(),t.$Notice.success({title:"删除成功"}),t.getTasks()}),(function(e){t.$Spin.hide(),t.$Notice.error({title:e.message})}))}})},enableTask:function(e){var t=this,o="/api/admin/task/enabled/";e.enabled&&(o="/api/admin/task/disabled/"),this.$Spin.show(),y.post(o+e.id,{},(function(){t.$Spin.hide(),t.$Notice.success({title:"操作成功"}),t.getTasks()}),(function(e){t.$Spin.hide(),t.$Notice.error({title:e.message})}))},getTasks:function(){var e=this;this.loading=!0,y.get("/api/tasks",(function(t){e.tasks=t,e.loading=!1}),(function(t){e.loading=!1}))},getExecHistory:function(){var e=this;this.$Spin.show(),this.execHistory=[];var t="/api/exec-history/";this.exceptionHistory&&(t="/api/exec-history/error/"),y.get(t+this.execHistoryTask.id+"/"+this.execHistorySize,(function(t){e.execHistory=t,e.execHistoryModal=!0,e.$Spin.hide()}),(function(t){e.$Spin.hide()}))}}},D=R,N=Object(c["a"])(D,T,_,!1,null,"02c790cd",null),z=N.exports;r["default"].use(d["a"]);var F=[{path:"/",name:"index",component:z},{path:"/login",name:"login",component:S}],J=new d["a"]({routes:F}),P=J,B=o("f825"),U=o.n(B);o("f8ce");r["default"].use(U.a),w.a.defaults.withCredentials=!1,r["default"].config.productionTip=!1,new r["default"]({router:P,render:function(e){return e(u)}}).$mount("#app")},"7b39":function(e,t,o){"use strict";o("ec31")},e248:function(e,t,o){},ec31:function(e,t,o){}});